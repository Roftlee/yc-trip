<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yc.trip.api.business.dao.store.StoreDao">

    <!-- 对象与字段映射 -->
    <resultMap type="com.yc.trip.api.business.bo.store.StoreDomain" id="StoreMap">
        <!--  -->
        <result property="id" column="id" />
        <!-- 门店名称 -->
        <result property="storeName" column="store_name" />
        <!-- 关联品牌id -->
        <result property="brandId" column="brand_id" />
        <!-- 联系人 -->
        <result property="linkMan" column="link_man" />
        <!-- 联系方式 -->
        <result property="linkNum" column="link_num" />
        <!-- 门店地址 -->
        <result property="address" column="address" />
        <!-- 到期时间 -->
        <result property="endTime" column="end_time" />
        <!-- 营业执照 -->
        <result property="licenseUrl" column="license_url" />
        <!-- 合同文件 -->
        <result property="contractUrl" column="contract_url" />
        <!-- 是否删除0否1是(枚举:YesNoStatus[core]) -->
        <result property="isDelete" column="is_delete"  javaType="com.yc.trip.api.core.enums.YesNoStatus"  typeHandler="org.go.api.core.typehandler.UniversalEnumHandler" />
        <!-- 创建时间 -->
        <result property="createdTime" column="created_time" />
        <!-- 更新时间 -->
        <result property="updatedTime" column="updated_time" />
    </resultMap>

    <!-- 新增门店信息 -->
    <insert id="addStore" parameterType="com.yc.trip.api.business.bo.store.StoreDomain" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `store`(
            store_name,
            brand_id,
            link_man,
            link_num,
            address,
            end_time,
            license_url,
            contract_url,
            is_delete)
        VALUES(
            #{storeName,jdbcType=VARCHAR},
            #{brandId,jdbcType=NUMERIC},
            #{linkMan,jdbcType=VARCHAR},
            #{linkNum,jdbcType=VARCHAR},
            #{address,jdbcType=VARCHAR},
            #{endTime,jdbcType=TIMESTAMP},
            #{licenseUrl,jdbcType=VARCHAR},
            #{contractUrl,jdbcType=VARCHAR},
            #{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
        )	
    </insert>
	
    <!-- 修改门店信息 -->
	<update id="updateStore" parameterType="com.yc.trip.api.business.bo.store.StoreDomain">
        UPDATE `store`
        <set>
            <if test="storeName!=null and storeName!='' ">
            store_name=#{storeName,jdbcType=VARCHAR},
            </if>
            <if test="brandId!=null ">
            brand_id=#{brandId,jdbcType=NUMERIC},
            </if>
            <if test="linkMan!=null and linkMan!='' ">
            link_man=#{linkMan,jdbcType=VARCHAR},
            </if>
            <if test="linkNum!=null and linkNum!='' ">
            link_num=#{linkNum,jdbcType=VARCHAR},
            </if>
            <if test="address!=null and address!='' ">
            address=#{address,jdbcType=VARCHAR},
            </if>
            <if test="endTime!=null ">
            end_time=#{endTime,jdbcType=TIMESTAMP},
            </if>
            <if test="licenseUrl!=null and licenseUrl!='' ">
            license_url=#{licenseUrl,jdbcType=VARCHAR},
            </if>
            <if test="contractUrl!=null and contractUrl!='' ">
            contract_url=#{contractUrl,jdbcType=VARCHAR},
            </if>
            <if test="isDelete!=null ">
            is_delete=#{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC},
            </if>
            <if test="createdTime!=null ">
            created_time=#{createdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updatedTime!=null ">
            updated_time=#{updatedTime,jdbcType=TIMESTAMP},
            </if>
        </set>
            WHERE id=#{id,jdbcType=NUMERIC}	
	</update>
	
    <!-- 查询门店信息 -->
	<select id="getStore" parameterType="com.yc.trip.api.business.bo.store.StoreDomain" resultMap="StoreMap">
        SELECT id,store_name,brand_id,link_man,
           link_num,address,end_time,license_url,
           contract_url,is_delete,created_time,updated_time
        FROM `store`
        <where>
            <if test="id!=null ">
                and id=#{id,jdbcType=NUMERIC}
            </if>
            <if test="storeName!=null and storeName!='' ">
                and store_name=#{storeName,jdbcType=VARCHAR}
            </if>
            <if test="brandId!=null ">
                and brand_id=#{brandId,jdbcType=NUMERIC}
            </if>
            <if test="linkMan!=null and linkMan!='' ">
                and link_man=#{linkMan,jdbcType=VARCHAR}
            </if>
            <if test="linkNum!=null and linkNum!='' ">
                and link_num=#{linkNum,jdbcType=VARCHAR}
            </if>
            <if test="address!=null and address!='' ">
                and address=#{address,jdbcType=VARCHAR}
            </if>
            <if test="licenseUrl!=null and licenseUrl!='' ">
                and license_url=#{licenseUrl,jdbcType=VARCHAR}
            </if>
            <if test="contractUrl!=null and contractUrl!='' ">
                and contract_url=#{contractUrl,jdbcType=VARCHAR}
            </if>
            <if test="isDelete!=null ">
                and is_delete=#{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
        </where>
        LIMIT 2	
	</select>
	
    <!-- 查询门店信息列表 -->
    <select id="queryStoreList" parameterType="com.yc.trip.api.business.bo.store.StoreDomain" resultMap="StoreMap">
            SELECT t.id,t.store_name,t.brand_id,t.link_man,
            t.link_num,t.address,t.end_time,t.license_url,
            t.contract_url,t.is_delete,t.created_time,t.updated_time
            FROM `store` t 
        <where>
            <if test="storeName!=null and storeName!='' ">
                AND store_name=#{storeName,jdbcType=VARCHAR}
            </if>
            <if test="brandId!=null ">
                AND brand_id=#{brandId,jdbcType=NUMERIC}
            </if>
            <if test="linkMan!=null and linkMan!='' ">
                AND link_man=#{linkMan,jdbcType=VARCHAR}
            </if>
            <if test="linkNum!=null and linkNum!='' ">
                AND link_num=#{linkNum,jdbcType=VARCHAR}
            </if>
            <if test="address!=null and address!='' ">
                AND address=#{address,jdbcType=VARCHAR}
            </if>
            <if test="licenseUrl!=null and licenseUrl!='' ">
                AND license_url=#{licenseUrl,jdbcType=VARCHAR}
            </if>
            <if test="contractUrl!=null and contractUrl!='' ">
                AND contract_url=#{contractUrl,jdbcType=VARCHAR}
            </if>
            <if test="isDelete!=null ">
                AND is_delete=#{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
            <if test="keywords!=null and keywords!='' ">
                AND (
                     store_name LIKE CONCAT('%', #{keywords}, '%')
                 )
            </if>
            <if test="ids!=null and ids.size!=0 ">
                AND id IN
                    <foreach item="item" index="index" collection="ids" open="(" separator="," close=")">  
                        #{item}
                    </foreach>
            </if>
            <if test="queryStartTime!=null">
                AND t.created_time >= #{queryStartTime}
            </if>
            <if test="queryEndTime!=null">
                <![CDATA[ AND t.created_time <= #{queryEndTime"} ]]>
            </if>
        </where>	
    </select>

    <select id="getAllStore" resultMap="StoreMap">
        select t.id,t.store_name from  FROM `store` t
    </select>
	
</mapper>
