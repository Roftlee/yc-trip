<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yc.trip.api.business.dao.train.TrainDao">

    <!-- 对象与字段映射 -->
    <resultMap type="com.yc.trip.api.business.bo.train.TrainDomain" id="TrainMap">
        <!--  -->
        <result property="id" column="id" />
        <!-- 标题 -->
        <result property="title" column="title" />
        <!-- 描述 -->
        <result property="description" column="description" />
        <!-- 所属供应商Id -->
        <result property="providerId" column="provider_id" />
        <!-- 视频url -->
        <result property="videoUrl" column="video_url" />
        <!-- 是否删除0否1是(枚举:YesNoStatus[core]) -->
        <result property="isDelete" column="is_delete"  javaType="com.yc.trip.api.core.enums.YesNoStatus"  typeHandler="org.go.api.core.typehandler.UniversalEnumHandler" />
        <!-- 创建时间 -->
        <result property="createdTime" column="created_time" />
        <!-- 更新时间 -->
        <result property="updatedTime" column="updated_time" />
    </resultMap>

    <!-- 新增培训信息 -->
    <insert id="addTrain" parameterType="com.yc.trip.api.business.bo.train.TrainDomain" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `train`(
            title,
            description,
            provider_id,
            video_url,
            is_delete)
        VALUES(
            #{title,jdbcType=VARCHAR},
            #{description,jdbcType=VARCHAR},
            #{providerId,jdbcType=NUMERIC},
            #{videoUrl,jdbcType=VARCHAR},
            #{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
        )	
    </insert>
	
    <!-- 修改培训信息 -->
	<update id="updateTrain" parameterType="com.yc.trip.api.business.bo.train.TrainDomain">
        UPDATE `train`
        <set>
            <if test="title!=null and title!='' ">
            title=#{title,jdbcType=VARCHAR},
            </if>
            <if test="description!=null and description!='' ">
            description=#{description,jdbcType=VARCHAR},
            </if>
            <if test="providerId!=null ">
            provider_id=#{providerId,jdbcType=NUMERIC},
            </if>
            <if test="videoUrl!=null and videoUrl!='' ">
            video_url=#{videoUrl,jdbcType=VARCHAR},
            </if>
            <if test="isDelete!=null ">
            is_delete=#{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC},
            </if>
            <if test="createdTime!=null ">
            created_time=#{createdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updatedTime!=null ">
            updated_time=#{updatedTime,jdbcType=TIMESTAMP},
            </if>
        </set>
            WHERE id=#{id,jdbcType=NUMERIC}	
	</update>
	
    <!-- 查询培训信息 -->
	<select id="getTrain" parameterType="com.yc.trip.api.business.bo.train.TrainDomain" resultMap="TrainMap">
        SELECT id,title,description,provider_id,
           video_url,is_delete,created_time,updated_time
        FROM `train`
        <where>
            <if test="id!=null ">
                and id=#{id,jdbcType=NUMERIC}
            </if>
            <if test="title!=null and title!='' ">
                and title=#{title,jdbcType=VARCHAR}
            </if>
            <if test="description!=null and description!='' ">
                and description=#{description,jdbcType=VARCHAR}
            </if>
            <if test="providerId!=null ">
                and provider_id=#{providerId,jdbcType=NUMERIC}
            </if>
            <if test="videoUrl!=null and videoUrl!='' ">
                and video_url=#{videoUrl,jdbcType=VARCHAR}
            </if>
            <if test="isDelete!=null ">
                and is_delete=#{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
        </where>
        LIMIT 2	
	</select>
	
    <!-- 查询培训信息列表 -->
    <select id="queryTrainList" parameterType="com.yc.trip.api.business.bo.train.TrainDomain" resultMap="TrainMap">
            SELECT t.id,t.title,t.description,t.provider_id,
            t.video_url,t.is_delete,t.created_time,t.updated_time
            FROM `train` t 
        <where>
            <if test="title!=null and title!='' ">
                AND title=#{title,jdbcType=VARCHAR}
            </if>
            <if test="description!=null and description!='' ">
                AND description=#{description,jdbcType=VARCHAR}
            </if>
            <if test="providerId!=null ">
                AND provider_id=#{providerId,jdbcType=NUMERIC}
            </if>
            <if test="videoUrl!=null and videoUrl!='' ">
                AND video_url=#{videoUrl,jdbcType=VARCHAR}
            </if>
            <if test="isDelete!=null ">
                AND is_delete=#{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
            <if test="keywords!=null and keywords!='' ">
                AND (
                     title LIKE CONCAT('%', #{keywords}, '%')
                     OR description LIKE CONCAT('%', #{keywords}, '%')
                     OR video_url LIKE CONCAT('%', #{keywords}, '%')
                 )
            </if>
            <if test="ids!=null and ids.size!=0 ">
                AND id IN
                    <foreach item="item" index="index" collection="ids" open="(" separator="," close=")">  
                        #{item}
                    </foreach>
            </if>
        </where>	
    </select>
	
</mapper>
