<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yc.trip.api.business.dao.order.OrderCustomerDao">

    <!-- 对象与字段映射 -->
    <resultMap type="com.yc.trip.api.business.dto.order.OrderCustomer" id="OrderCustomerMap">
        <!--  -->
        <result property="id" column="id" />
        <!-- 订单号 -->
        <result property="orderId" column="order_id" />
        <!-- 姓名 -->
        <result property="name" column="name" />
        <!-- 电话 -->
        <result property="phone" column="phone" />
        <!-- 身份证号 -->
        <result property="idCard" column="id_card" />
        <!-- 创建时间 -->
        <result property="createdTime" column="created_time" />
        <!-- 更新时间 -->
        <result property="updatedTime" column="updated_time" />
    </resultMap>

    <!-- 订单人员信息新增 -->
    <insert id="add" parameterType="com.yc.trip.api.business.dto.order.OrderCustomer" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `order_customer`(
            order_id,
            name,
            phone,
            id_card,
        )
        VALUES(
            #{orderId,jdbcType=NUMERIC},
            #{name,jdbcType=VARCHAR},
            #{phone,jdbcType=VARCHAR},
            #{idCard,jdbcType=VARCHAR},
        )	
    </insert>
	
    <!-- 订单人员信息 修改-->
	<update id="update" parameterType="com.yc.trip.api.business.dto.order.OrderCustomer">
        UPDATE `order_customer`
        <set>
            <if test="orderId!=null ">
            order_id=#{orderId,jdbcType=NUMERIC},
            </if>
            <if test="name!=null and name!='' ">
            name=#{name,jdbcType=VARCHAR},
            </if>
            <if test="phone!=null and phone!='' ">
            phone=#{phone,jdbcType=VARCHAR},
            </if>
            <if test="idCard!=null and idCard!='' ">
            id_card=#{idCard,jdbcType=VARCHAR},
            </if>
            <if test="createdTime!=null ">
            created_time=#{createdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updatedTime!=null ">
            updated_time=#{updatedTime,jdbcType=TIMESTAMP},
            </if>
        </set>
            WHERE id=#{id,jdbcType=NUMERIC}	
	</update>
	
    <!-- 订单人员信息 查询-->
	<select id="get" parameterType="com.yc.trip.api.business.query.order.OrderCustomerQuery" resultMap="OrderCustomerMap">
        SELECT id,order_id,name,phone,
           id_card,created_time,updated_time
        FROM `order_customer`
        <where>
            <if test="id!=null ">
                AND id=#{id,jdbcType=NUMERIC}
            </if>
            <if test="orderId!=null ">
                AND order_id=#{orderId,jdbcType=NUMERIC}
            </if>
            <if test="name!=null and name!='' ">
                AND name=#{name,jdbcType=VARCHAR}
            </if>
            <if test="phone!=null and phone!='' ">
                AND phone=#{phone,jdbcType=VARCHAR}
            </if>
            <if test="idCard!=null and idCard!='' ">
                AND id_card=#{idCard,jdbcType=VARCHAR}
            </if>
        </where>
        LIMIT 2	
	</select>
	
    <!-- 订单人员信息列表查询 -->
    <select id="queryList" parameterType="com.yc.trip.api.business.query.order.OrderCustomerQuery" resultMap="OrderCustomerMap">
            SELECT t.id,t.order_id,t.name,t.phone,
            t.id_card,t.created_time,t.updated_time
            FROM `order_customer` t 
        <where>
            <if test="orderId!=null ">
                AND order_id=#{orderId,jdbcType=NUMERIC}
            </if>
            <if test="name!=null and name!='' ">
                AND name=#{name,jdbcType=VARCHAR}
            </if>
            <if test="phone!=null and phone!='' ">
                AND phone=#{phone,jdbcType=VARCHAR}
            </if>
            <if test="idCard!=null and idCard!='' ">
                AND id_card=#{idCard,jdbcType=VARCHAR}
            </if>
            <if test="keywords!=null and keywords!='' ">
                AND (
                     name LIKE CONCAT('%', #{keywords}, '%')
                     OR phone LIKE CONCAT('%', #{keywords}, '%')
                     OR id_card LIKE CONCAT('%', #{keywords}, '%')
                 )
            </if>
            <if test="ids!=null and ids.size!=0 ">
                AND id IN
                    <foreach item="item" index="index" collection="ids" open="(" separator="," close=")">  
                        #{item}
                    </foreach>
            </if>
        </where>	
    </select>
	
</mapper>
