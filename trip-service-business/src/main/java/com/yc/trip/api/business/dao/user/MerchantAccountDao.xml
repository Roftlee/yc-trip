<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yc.trip.api.business.dao.user.MerchantAccountDao">

    <!-- 对象与字段映射 -->
    <resultMap type="com.yc.trip.api.business.bo.user.MerchantAccountDomain" id="MerchantAccountMap">
        <!--  -->
        <result property="id" column="id" />
        <!-- 供应商id -->
        <result property="merchantId" column="merchant_id" />
        <!-- 用户id -->
        <result property="userId" column="user_id" />
        <!-- 商户类型1供应商2门店(枚举:MerchantType) -->
        <result property="merchantType" column="merchant_type"  javaType="com.yc.trip.api.business.enums.user.MerchantType"  typeHandler="org.go.api.core.typehandler.UniversalEnumHandler" />
        <!-- 账号类型1主账号2子账号(枚举:AccountType) -->
        <result property="accountType" column="account_type"  javaType="com.yc.trip.api.business.enums.user.AccountType"  typeHandler="org.go.api.core.typehandler.UniversalEnumHandler" />
        <!-- 账号有效截止日期 -->
        <result property="endTime" column="end_time" />
        <!-- 是否删除(枚举:YesNoStatus[core]) -->
        <result property="isDelete" column="is_delete"  javaType="com.yc.trip.api.core.enums.YesNoStatus"  typeHandler="org.go.api.core.typehandler.UniversalEnumHandler" />
        <!-- 创建时间 -->
        <result property="createdTime" column="created_time" />
        <!-- 更新时间 -->
        <result property="updatedTime" column="updated_time" />
    </resultMap>

    <!-- 新增商户账号信息 -->
    <insert id="addMerchantAccount" parameterType="com.yc.trip.api.business.bo.user.MerchantAccountDomain" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `merchant_account`(
            merchant_id,
            user_id,
            merchant_type,
            account_type,
            end_time,
            is_delete)
        VALUES(
            #{merchantId,jdbcType=NUMERIC},
            #{userId,jdbcType=NUMERIC},
            #{merchantType, javaType=com.yc.trip.api.business.enums.user.MerchantType, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC},
            #{accountType, javaType=com.yc.trip.api.business.enums.user.AccountType, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC},
            #{endTime,jdbcType=DATE},
            #{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
        )	
    </insert>
	
    <!-- 修改商户账号信息 -->
	<update id="updateMerchantAccount" parameterType="com.yc.trip.api.business.bo.user.MerchantAccountDomain">
        UPDATE `merchant_account`
        <set>
            <if test="merchantId!=null ">
            merchant_id=#{merchantId,jdbcType=NUMERIC},
            </if>
            <if test="userId!=null ">
            user_id=#{userId,jdbcType=NUMERIC},
            </if>
            <if test="merchantType!=null ">
            merchant_type=#{merchantType, javaType=com.yc.trip.api.business.enums.user.MerchantType, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC},
            </if>
            <if test="accountType!=null ">
            account_type=#{accountType, javaType=com.yc.trip.api.business.enums.user.AccountType, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC},
            </if>
            <if test="endTime!=null ">
            end_time=#{endTime,jdbcType=DATE},
            </if>
            <if test="isDelete!=null ">
            is_delete=#{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC},
            </if>
            <if test="createdTime!=null ">
            created_time=#{createdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updatedTime!=null ">
            updated_time=#{updatedTime,jdbcType=TIMESTAMP},
            </if>
        </set>
            WHERE id=#{id,jdbcType=NUMERIC}	
	</update>
	
    <!-- 查询商户账号信息 -->
	<select id="getMerchantAccount" parameterType="com.yc.trip.api.business.bo.user.MerchantAccountDomain" resultMap="MerchantAccountMap">
        SELECT id,merchant_id,user_id,merchant_type,
           account_type,end_time,is_delete,created_time,
           updated_time
        FROM `merchant_account`
        <where>
            <if test="id!=null ">
                and id=#{id,jdbcType=NUMERIC}
            </if>
            <if test="merchantId!=null ">
                and merchant_id=#{merchantId,jdbcType=NUMERIC}
            </if>
            <if test="userId!=null ">
                and user_id=#{userId,jdbcType=NUMERIC}
            </if>
            <if test="merchantType!=null ">
                and merchant_type=#{merchantType, javaType=com.yc.trip.api.business.enums.user.MerchantType, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
            <if test="accountType!=null ">
                and account_type=#{accountType, javaType=com.yc.trip.api.business.enums.user.AccountType, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
            <if test="isDelete!=null ">
                and is_delete=#{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
        </where>
        LIMIT 2	
	</select>
	
    <!-- 查询商户账号信息列表 -->
    <select id="queryMerchantAccountList" parameterType="com.yc.trip.api.business.bo.user.MerchantAccountDomain" resultMap="MerchantAccountMap">
            SELECT t.id,t.merchant_id,t.user_id,t.merchant_type,
            t.account_type,t.end_time,t.is_delete,t.created_time,
            t.updated_time
            FROM `merchant_account` t 
        <where>
            <if test="merchantId!=null ">
                AND merchant_id=#{merchantId,jdbcType=NUMERIC}
            </if>
            <if test="userId!=null ">
                AND user_id=#{userId,jdbcType=NUMERIC}
            </if>
            <if test="merchantType!=null ">
                AND merchant_type=#{merchantType, javaType=com.yc.trip.api.business.enums.user.MerchantType, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
            <if test="accountType!=null ">
                AND account_type=#{accountType, javaType=com.yc.trip.api.business.enums.user.AccountType, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
            <if test="isDelete!=null ">
                AND is_delete=#{isDelete, javaType=com.yc.trip.api.core.enums.YesNoStatus, typeHandler=org.go.api.core.typehandler.UniversalEnumHandler, jdbcType=NUMERIC}
            </if>
            <if test="keywords!=null and keywords!='' ">
                AND (
                 )
            </if>
            <if test="ids!=null and ids.size!=0 ">
                AND id IN
                    <foreach item="item" index="index" collection="ids" open="(" separator="," close=")">  
                        #{item}
                    </foreach>
            </if>
        </where>	
    </select>
	
</mapper>
